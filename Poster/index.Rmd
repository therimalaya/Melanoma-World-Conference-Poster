---
main_topsize: 0.2 #percent coverage of the poster
main_bottomsize: 0.05
poster_width: '36in'
poster_height: '64in'
affiliation_textsize: '30px'
reference_textsize: '75%'
title: '**Long-term trends in melanoma tumour thickness in Norway**'
author:
  - name: '**Raju Rimal**'
    affil: 1
    main: true
    orcid: '0000-0002-1099-3857'
    twitter: mathatistics
    email: raju.rimal@medisin.uio.no
  - name: Raju Rimal
    affil: 1
  - name: Trude E Robsahm
    affil: 2
  - name: Adele Green
    affil: 3,4
  - name: Reza Ghiasvand
    affil: 2,5
  - name: Corina S Rueegg
    affil: 5
  - name: Assia Bassarova
    affil: 6
  - name: Petter Gjersvik
    affil: 7
  - name: Elisabete Weiderpass
    affil: 8
  - name: Odd O Aalen
    affil: 1
  - name: Bjørn Møller
    affil: 9
  - name: Marit B Veierød
    affil: 1
affiliation:
  - num: 1
    address: Oslo Centre for Biostatistics and Epidemiology, Department of Biostatistics, Institute of Basic Medical Sciences, University of Oslo, Oslo, Norway
  - num: 2
    address: Department of Research, Cancer Registry of Norway, Oslo, Norway
  - num: 3
    address: Department of Population Health, QIMR Berghofer Medical Research Institute, Brisbane, Australia
  - num: 4
    address: Cancer Research UK Manchester Institute, University of Manchester, Manchester, United Kingdom
  - num: 5
    address: Oslo Centre for Biostatistics and Epidemiology, Oslo University Hospital, Oslo, Norway
  - num: 6
    address: Department of Pathology, Oslo University Hospital -- Ullevål, Oslo, Norway
  - num: 7
    address: Institute of Clinical Medicine, University of Oslo, Oslo, Norway
  - num: 8
    address: International Agency for Research on Cancer, Lyon, France
  - num: 9
    address: Department of Registration, Cancer Registry of Norway, Oslo, Norway
logoleft_name: uio-logo.png
logoright_name: nfr-logo.svg
logo_top_right: uio-seal.png
custom_css: custom.css
column_numbers: 2
output: 
  posterdown::posterdown_betterport:
    template: template.html
    self_contained: false
    pandoc_args: --mathjax
    number_sections: false
bibliography: references.bib
citation-style: bmj.csl
link-citations: true
editor_options: 
  chunk_output_type: console
---

```{r, include=FALSE}
knitr::opts_chunk$set(
  results = 'asis',
  echo = FALSE,
  warning = FALSE,
  tidy = FALSE,
  message = FALSE,
  dev = 'svg',
  fig.align = 'center',
  out.width = "100%",
  fig.retina = 2
)
# options(knitr.table.format = "html") 

library(data.table)
library(gt)
library(kableExtra)
library(gtsummary)
library(ggplot2)
library(stringr)

# gtsummary::theme_gtsummary_compact()
gtsummary::theme_gtsummary_journal('jama')
```

```{r, include=FALSE}
DATA_PATH <- ifelse(.Platform$OS.type == "windows", "E:/Melanoma-Postdoc/Data", "data")
BASE_PATH <- ifelse(
  .Platform$OS.type == "windows", 
  "////platon/med-imb-u1/rajur/pc/Dokumenter/Analysis", 
  "~/Documents/Papers/Analysis"
)
source(file.path(BASE_PATH, "scripts/00-functions.R"))
data <- readRDS(file.path(BASE_PATH, "data/extended.rds"))
levels(data$AnatomicSite) <- gsub("extremities", "limbs", levels(data$AnatomicSite))
```

```{r make-plot}
make_plot <- function(data, aes_mapping, ylab = "Proportion", facet = NULL, geom = NULL, guide_row = NULL, ...) {
  plt <- data %>% 
    ggplot(aes_mapping, ...) +
    ggthemes::scale_color_stata(na.value = "gray40") +
    ggthemes::scale_fill_stata(na.value = "gray40") +
    ggthemes::theme_few() +
    theme(legend.position = 'bottom', axis.text.x = element_text(vjust = 0.5)) +
    labs(x = "Year of diagnosis", y = ylab)
  if (data %>% dplyr::select(!!aes_mapping$x) %>% purrr::pluck(1) %>% is.factor()) {
    plt <- plt + 
      scale_x_discrete(labels = function(x) str_remove(x, "^....-"))
  }
  if (is.null(geom)) plt <- plt + geom_point(stroke = 0.4, size = 1, ) + geom_line()
  if (!is.null(geom$vline)) plt <- plt + geom$vline
  if (!is.null(geom$line)) plt <- plt + geom$line
  if (!is.null(geom$point)) plt <- plt + geom$point
  if (!is.null(geom$bar)) plt <- plt + geom$bar
  if (!is.null(geom$text)) plt <- plt + geom$text
  if (!is.null(facet)) plt <- plt + facet
  if (!is.null(guide_row)) plt <- plt + guides(
    color = guide_legend(nrow = guide_row),
    fill = guide_legend(nrow = guide_row),
    label = guide_legend(nrow = guide_row)
  )
  if (grepl("[Pp]rop", ylab)) plt <- plt + scale_y_continuous(labels = scales::percent)
  return(plt)
}
```

# Background

Incidence of cutaneous melanoma has increased in fair-skinned populations during the past decades [@whiteman_growing_2016]. Tumour (Breslow) thickness at diagnosis is important for assessing early detection. Tumour thickness is the primary determinant of the T category in the Tumor-Node-Metastasis (TNM) staging system, and the most important prognostic factor for survival after localized melanoma [@gershenwald_melanoma_2017].

**Aim:** This newly started study investigates long-term trends in tumour thickness, and the corresponding T categories, overall and in important subgroups such as sex, age and anatomic sites, in a nationwide case series over a 40-year time period.

# Methods

```{r}
nobs <- nrow(data)
```

The population-based Cancer Registry of Norway (CRN) provided all morphologically verified first primary invasive cutaneous melanoma cases diagnosed in 1980-2019. Tumour thickness was available from the Norwegian  Melanoma Registry (within the CRN) for all cases diagnosed in 2008-2019 and was manually extracted from the paper notifications archived in the CRN for the cases diagnosed in 1980- 2007. The calendar period of diagnosis was categorized as 1980-1999, 2000-2007, and 2008-2019. Covariates include sex, age, residential geographical region, anatomic site, histopathological subtype, clinical stage, and ulceration. 

Descriptive summaries are presented as frequencies (numbers, %) and medians with interquartile ranges (IQR).
In the figures, we present proportions of patients diagnosed with T1-T4 melanoma per year. The thickness of the lines reflects the number of cases in each period.

# Results

```{r characteristic-table}
tbl <- Fn$gt_grouped_summary(
  data = data,
  variables = c(
    AgeDiag = "Age at diagnosis",
    AgeGroup = "Age group",
    AnatomicSite = "Anatomic site",
    MelanomaType = "Histopathological subtype"
  ),
  group = c("Sex", "YearCat")
) 
tbl %>% 
  as_gt(id = "table-1") %>% 
  gt::tab_options(
    container.width = '100%', 
    table.width = '100%', 
    container.height = '100%',
    table.font.size = '80%',
    row.striping.background_color = '#fcfcfc',
    table.font.color = '#454545'
  ) %>% 
  gt::tab_header(
    title = gt::md(paste0(
      "**Table 1: Characteristics of Norwegian melanoma cases, 1980-2019 ",
      "(N = ", format(nobs, big.mark = ","), ")**"
    ))
  )
```

```{r}
bt <- data[, lapply(list(
  Median = function(x) median(x, na.rm = TRUE),
  Q1 = function(x) quantile(x, 0.25, na.rm = TRUE),
  Q2 = function(x) quantile(x, 0.75, na.rm = TRUE)
), function(fn) fn(BreslowThickness)), by = .(YearCat, Sex)] %>% 
  .[, label := paste0(Median, " mm ", "(", paste(Q1, Q2, sep = "--"), ")")] %>% 
  .[YearCat %in% c('1980-1999', '2008-2019')]
```

In both men and women, the median age at diagnosis increased from 1980-2000 to 2008-2019 (Table 1).

```{r tumour-thickness-table}
tbl <- Fn$gt_grouped_summary(
  data = data,
  variables = c(
    BreslowThickness = "Tumour thickness",
    BreslowTstage = "T category"
  ),
  group = c("Sex", "YearCat")
)
missing_breslow <- data[, .N, by = .(Sex, YearCat, is.na(BreslowThickness))] %>% 
  .[, Prop := prop.table(N), by = .(Sex, YearCat)] %>% 
  .[(is.na)] %>% 
  .[, label := paste(
    format(N, big.mark = ","), 
    " (", scales::percent(Prop, accuracy = 0.1), ")", 
    sep = "")] %>% 
  .[order(Sex, YearCat)]

tbl$table_body[2, grep("^stat_\\d", names(tbl$table_body))] <- as.list(purrr::pluck(missing_breslow, 'label'))
tbl$table_body <- tbl$table_body %>% dplyr::filter(!(row_type == "missing" & variable == "BreslowTstage"))
tbl$table_body$label[2] <- "Unspecified (% of N)"

tbl$table_body[4, "label"] <- list("T1 (>=1mm)")
tbl$table_body[5, "label"] <- list("T2 (>1-2mm)")
tbl$table_body[6, "label"] <- list("T3 (>2-4mm)")
tbl$table_body[7, "label"] <- list("T4 (>4mm)")


tbl %>% 
  as_gt(id = "table-1") %>% 
  gt::tab_options(
    container.width = '100%', 
    table.width = '100%', 
    container.height = '100%',
    table.font.size = '80%',
    row.striping.background_color = '#fcfcfc',
    table.font.color = '#454545'
  ) %>% 
  gt::tab_header(
    title = gt::md(paste0(
      "**Table 2: Tumour thickness and T category, 1980-2019 ", 
      "(N = ", format(nobs, big.mark = ","), ")**")
  )) %>% 
  gt::text_transform(cells_body(1, 2), function(x) str_replace(x, " \\(", "<br>(")) %>%
  gt::text_transform(cells_body(everything(), 1:2), function(x) str_replace(x, " \\(", "<br>("))
```

Tumour thickness was missing in the pathology reports for almost 30% of the cases until 1999. After the Norwegian Melanoma Registry was established in 2008, the proportions of missing decreased dramatically (Table 2). In all time periods, women were diagnosed at a thinner stage than men. In men, median (IQR) tumour thickness decreased from `r bt[Sex=="Men" & YearCat == "1980-1999", label]` in 1980-1999 to `r bt[Sex=="Men" & YearCat == "2008-2019", label]` in 2008-2019, and in women from `r bt[Sex=="Women" & YearCat == "1980-1999", label]` to `r bt[Sex=="Women" & YearCat == "2008-2019", label]`.

```{r tumour-thickness, fig.asp=0.5}
plt_data <- data[, .(Cases = .N), by = .(BreslowTstage, Sex, DiagYear = DiagYear5)] %>% 
  na.omit() %>% 
  .[, Prop := prop.table(Cases), by = .(Sex, DiagYear)]
make_plot(
  data = plt_data,
  aes_mapping = aes(
    DiagYear, Prop, 
    color = BreslowTstage, 
    group = BreslowTstage,
    size = Cases
  ),
  facet = facet_grid(cols = vars(Sex)),
  geom = list(
    vline = geom_vline(xintercept = "2005-2009", color = "#AFAFAF", linetype = "dashed"),
    point = geom_point(shape = 23, fill = "whitesmoke", size = rel(2)),
    line = geom_line(lineend = "round", linejoin = "round", alpha = 0.8)
  )
) + labs(
  title = "Figure 1: Proportion of cases in each T-category per year, by sex",
  color = "T category",
  caption = "- - - Melanoma registry established"
) +
  scale_y_continuous(breaks = scales::breaks_width(0.1), labels = scales::percent) +
  scale_size_continuous(range = c(0.2, 3)) +
  expand_limits(y = 0) +
  theme(plot.caption = element_text(hjust = 0.5))
```

More than 40% of the cases in women and more than 30% in men were diagnosed as T1 (≤1mm), and the proportion of T1 increased over time in both men and women. T2  (>1-2mm) was almost constant over time (20-25%), while T3 (>2-4mm) declined. T4 (>4mm) declined more in men, especially in the most recent years, and was more constant in women. The dashed line indicates when the melanoma registry was established.

```{r plt-age-group, fig.asp=0.5, fig.width=8}
plt_data <- data[, .N, by = .(AgeGroup, Sex, DiagYear = DiagYear5, BreslowTstage)] %>% 
  na.omit() %>%
  .[, Prop := prop.table(N), by = .(DiagYear, Sex, AgeGroup)] %>% 
  .[!AgeGroup %in% c('≤20', '>85')]
make_plot(
  data = plt_data, 
  aes_mapping = aes(DiagYear, Prop, color = BreslowTstage, group = BreslowTstage),
  facet = facet_grid(
    cols = vars(AgeGroup),
    rows = vars(Sex),
    labeller = labeller(.cols = function(x) paste0("Age: ", x))
  ),
  geom = list(
    vline = geom_vline(xintercept = "2005-2009", color = "#AFAFAF", linetype = "dashed"),
    point = geom_point(stroke = 0.4, size = 1.2, shape = 23, fill = "whitesmoke"),
    line = geom_line(aes(size = N), lineend = "round", linejoin = "round", alpha = 0.8)
  )
) + expand_limits(y = c(0, 0.7)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        plot.caption = element_text(hjust = 0.5)) +
  scale_size_continuous(range = c(0.2, 3)) +
  labs(color = "T category", 
       title = "Figure 2: Proportion of cases in each T-category per year, by sex and age group", 
       size = "Cases",
       caption = "- - - Melanoma registry established"
  )
```

Similar trends in the T category at diagnosis were observed in all age-groups 21-85 years. The largest proportions of cases were in T1, but the T1 proportion was lower in the oldest age group (61-85 years) where thicker melanomas were more common.

```{r plt-anatomic-site, fig.asp=0.5, fig.width=8}
plt_data <- data[, .N, by = .(AnatomicSite, Sex, DiagYear = DiagYear5, BreslowTstage)] %>% 
  na.omit() %>% 
  .[, Prop := prop.table(N), by = .(DiagYear, Sex, AnatomicSite)] %>% 
  .[AnatomicSite != "Other"]
make_plot(
  data = plt_data, 
  aes_mapping = aes(DiagYear, Prop, color = BreslowTstage, group = BreslowTstage),
  facet = facet_grid(
    cols = vars(AnatomicSite),
    rows = vars(Sex)
  ),
  geom = list(
    vline = geom_vline(xintercept = "2005-2009", color = "#AFAFAF", linetype = "dashed"),
    point = geom_point(stroke = 0.4, size = 1, shape = 23, fill = "whitesmoke"),
    line = geom_line(aes(size = N), lineend = "round", linejoin = "round", alpha = 0.8)
  )
) + expand_limits(y = c(0, 0.7)) +
  theme(axis.text.x = element_text(angle = 90, hjust = 1),
        plot.caption = element_text(hjust = 0.5)) +
  scale_size_continuous(range = c(0.2, 3)) +
  labs(color = "T category", 
       title = "Figure 3: Proportion of cases in each T-category per year, by sex and anatomic site", 
       size = "Cases",
       caption = "- - - Melanoma registry established")
```

Thin (T1) melanoma was most common in all anatomic sites, and the proportion of T1 showed a clear increase in the recent years for head/neck and upper extremities in men, and trunk and lower extremities in both men and women.

# Conclusions

The proportion of melanomas diagnosed as T1 was highest in women but increased over time in both men and women. T2 was more stable. T3 decreased, while the proportion of T4 also decreased in some of the subgroups. The oldest age group still has the largest proportion of thick melanomas. This unique national case series will form the basis for studies of melanoma incidence and mortality in relation to tumour thickness, overall and in subgroups of the population.

**Funding:** This project is funded by the Norwegian Research Council (project no. 302048) and UNIFOR-FRIMED (2019).

# Reference